<!DOCTYPE html>
<html ng-app="app" ng-controller="main">
<head>
<meta name="viewport" content="width=360,minimum-scale=1,maximum-scale=1" />
<meta name="mobile-web-app-capable" content="yes" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title ng:bind-template="{{audio.info.name||'ready'}} - {{audio.info.artist||'foo_mg_www'}}">FooMG</title>
<link type="text/css" href="css/theme.css" rel="stylesheet" />
<link type="text/css" href="css/index.css" rel="stylesheet" />
</head>
<body ng-class="[ tool.show&&'show-tool', list.onEdit&&'show-foot',
		setting.folder_view_class||'aa-block-view', location.path+'-mode']"
	bw-main="browser.url" bw-main-cache="{{setting.lists_in_cache||4}}"
	pl-ctrl="audio[pl-audio]"
	pl-ctrl-next="{{!setting.play_single_track}}" pl-ctrl-loop="{{!setting.play_no_loop}}">
<div class="overlay show-list-mode" any-move="tool.show=false"></div>
<div class="head show-list-mode no-wrap no-overflow anim-transform">
	<div class="float-right">
		<button class="no-margin" ng-click="tool.toggle('nav')">
			<img height="38px" src="img/ic_action_search.png" />
		</button>
		<span class="no-overflow no-wrap">
			<select class="absolute no-opacity" style="-webkit-appearance:none;width:45px;height:45px"
				ng-model="headActions" ng-change="$eval(headActions);headActions=''">
				<optgroup label="View...">
					<option value="tool.show='play'">Playlists</option>
					<option value="tool.show='conf'">Settings</option>
				</optgroup>
				<option value="location.reload()">Reload</option>
				<option value="">Cancel</option>
			</select>
			<button class="no-margin">
				<img height="38px" src="img/ic_action_overflow.png" />
			</button>
		</span>
	</div>
	<div class="hide-too-wide bold big cursor-hand">
		<span class="absolute no-opacity"
			ng-show="list.parent" ng-click="browser.browse(browser.parentPath)">FuxxIE</span>
		<div class="no-overflow text-ellipsis" ng-click="tool.toggle('res')">{{browser.name}}</div>
	</div>
	<div class="hide-too-narrow no-overflow bg-white">
		<span ng-repeat="(p, n) in browser.pathSplit">
			<button class="no-overflow no-wrap no-margin bold big text-ellipsis"
				ng-click="browser.browse(p)" ng-class="p!=browser.path&&'gray'">{{n}}</button>
			<span class="gray">&gt;</span>
		</span>
	</div>
</div>
<ul class="main list show-list-mode ng-hide"
	ng-class="[groupCount>3&&'small-sep',onEdit&&'on-edit']"
	bw-list ng-non-bindable ng-show="url==browser.url">
	<div ng-if="word" ng-click="browser.browse(path)">
		<div class="tip cursor-hand fixed full-width">Searching '{{word}}'</div>
		<div class="tip">Searching '{{word}}'</div>
	</div>
	<div ng-if="i.newGroup" class="sep" ng-repeat-start="i in ls"
		ng-attr-style="background-image:{{i.aaCssUrl}}">
		<small class="link cursor-hand" ng-click="image.open(i.aaUrl, true)">&raquo;</small>
		<div class="bg" ng-click="i.path ? browser.browse(i.path) : select.toggle(0, i.group)">
			<big class="stress">{{i.album}}</big> ({{i.album_artist}})
		</div>
	</div>
	<li ng-if="i.typ=='folder'" class="folder" bw-id="{{i.id}}"
		ng-attr-title="{{i.name}}" ng-click="browser.browse(i.path)">
		<div class="albumart" ng-attr-style="background-image:{{i.aaCssUrl}}"></div>
		<span class="float-right">&gt;</span>
		{{i.shortName}}
		<div class="info">{{i.bracS}} {{i.bracR}}</div>
	</li>
	<li ng-if="i.typ=='track'" class="track {{i.id==audio.id&&audio.state}}" ng-repeat-end
		pl-id="{{i.id}}" bw-group="{{i.group}}"
		ng-click="onEdit ? select.toggle(i.id) : browser.playCurrent(i.id)">
		<span class="num">{{i.num}}</span>
		<span class="duration" ng-click="select.toggle(i.id);$event.stopPropagation()">
			<span class="current">{{audio.current.mmss}}/</span>{{i.length}}<br />
			<div class="check"></div>
		</span>
		{{i.name}}
		<div class="info">&lt;{{i.artist}}&gt;</div>
	</li>
	<div class="loading anim-all anim-in-1s" show-delay="500" ng-hide="ls.length==total">
		loading {{total?'('+ls.length+'/'+total+')':'...'}}
	</div>
	<div class="empty" ng-hide="total!=0">No thing here</div>
</ul>
<div class="foot show-list-mode no-wrap no-overflow">
	<button ng-click="tool.show=='play'?browser.save():tool.toggle('play')">
		<img height="36px" src="img/ic_action_accept.png" />
	</button>
	<button ng-click="select.all()">
		<img height="36px" src="img/ic_action_select_all.png" />
	</button>
	<button ng-click="select.toggle()">
		<img height="36px" src="img/ic_action_refresh.png" />
	</button>
	<button ng-click="select.clear()">
		<img height="36px" src="img/ic_action_view_as_grid.png" />
	</button>
	<button class="float-right" ng-click="select.finish()">
		<img height="36px" src="img/ic_action_cancel.png" />
	</button>
</div>
<div class="tool show-list-mode anim-transform" ng-init="tool.showing='nav'">
	<button class="hide-too-wide float-right" style="padding:5px;"
		ng-click="tool.show=''">X</button>
	<h3 class="title no-wrap no-overflow">
		<button ng-class="tool.showing=='nav'||'gray'"
			ng-click="tool.toggle('nav')">Search</button>
		<button ng-class="tool.showing=='play'||'gray'"
			ng-click="tool.toggle('play')">Playlists</button>
		<button ng-class="tool.showing=='res'||'gray'"
			ng-click="tool.toggle('res')">Resource</button>
		<button ng-class="tool.showing=='conf'||'gray'"
			ng-click="tool.toggle('conf')">Settings</button>
	</h3>
	<div class="content" ng-show="tool.showing=='play'">
		<p>
			<button ng-hide="list.onEdit"
				ng-click="select.start();tool.autoHide()">[ Select ]</button>
			<button ng-show="list.onEdit"
				ng-click="select.finish();tool.autoHide()">[ Cancel ]</button>
			<span ng-hide="list.onEdit&&!select.length()">
				<button ng-click="browser.save()">[ Save ]</button>
				<span class="no-overflow no-wrap">
					<select class="absolute no-opacity" style="max-width:90px;"
						ng-model="replaceUrl" ng-change="browser.replace()">
						<option></option>
						<option ng-repeat="(u, n) in playlists" ng-value="u" ng-if="n">{{n}}</option>
					</select>
					<button>[ Replace ]</button>
				</span>
				<span class="no-overflow no-wrap">
					<select class="absolute no-opacity" style="max-width:90px;"
						ng-model="addToUrl" ng-change="browser.addTo()">
						<option></option>
						<option ng-repeat="(u, n) in playlists" ng-value="u" ng-if="n">{{n}}</option>
					</select>
					<button>[ AddTo ]</button>
				</span>
			</span>
		</p>
		<ul ng-init="playlists=conf.local_store_dict('playlists@')">
			<!-- Note: neither ng-class nor ng-show works with ng-repeat -->
			<li ng-repeat="(u, n) in playlists"
				class="playlist {{u==browser.url&&'bold'}} {{u==player.url&&'play'}}">
				<form ng-show="n.length||f" action="javascript:void(null)" onsubmit="$('button').focus()">
					<button onclick="$(this).next().setfocus()" title="Edit Playlist Name">&sect;</button>
					<input local-store="playlists@{{u}}" local-store-init="n"
						pl-url="{{u}}" ng-focus='f=1' ng-blur='f=0' ng-model="playlists[u]" />
					<a href="javascript:void(null)" ng-click="browser.open(u)">{{n}}</a>
				</form>
			</li>
		</ul>
	</div>
	<div class="content" ng-show="tool.showing=='nav'">
		<form action="javascript:void(null)" ng-submit="browser.search()">
			<div class="search">
				<input type="text" name="word" ng-model="search.word" />
				<input type="submit" value="Search" />
				<p>
					<label><input type="checkbox" ng-model="search.fields.folder" />Folder</label>
					<label><input type="checkbox" ng-model="search.fields.album" />Album</label>
					<label><input type="checkbox" ng-model="search.fields.artist" />Artist</label>
					<label><input type="checkbox" ng-model="search.fields.title" />Title</label>
					<label><input type="checkbox" ng-model="search.onpath" />Search under current folder</label>
				</p>
			</div>
		</form>
	</div>
	<div class="content" ng-show="tool.showing=='res'">
		<p>
			<button ng-click="browser.browse(browser.parentPath)">[ Parent ]</button>
			<button ng-click="browser.reload()">[ Refresh ]</button>
		</p>
		<div class="gray" ng-hide="list.resList.length">No Resource Here</div>
		<ul>
			<li ng-repeat="i in list.resList" ng-switch on="i.typ">
				<div ng-switch-when="img">
					<a ng-show="setting.img_open_self" href="javascript:void(null)"
						ng-click="image.open(i.url)">{{i.name}}</a>
					<a ng-hide="setting.img_open_self" target="blank" ng-href="{{i.url}}">{{i.name}}</a>
				</div>
				<div ng-switch-when="txt">
					<a ng-show="setting.txt_open_self" href="javascript:void(null)"
						ng-click="tool.showTxt(i.name, i.url)">{{i.name}}</a>
					<a ng-hide="setting.txt_open_self" target="blank" ng-href="{{i.url}}">{{i.name}}</a>
				</div>
				<a ng-switch-default target="blank" ng-href="{{i.url}}">{{i.name}}</a>
			</li>
		</ul>
	</div>
	<div class="content" ng-show="tool.showing=='txt'">
		<h4>{{tool.showTxt.title}}</h4>
		<pre>{{tool.showTxt.text}}</pre>
	</div>
	<div class="content" ng-show="tool.showing=='conf'">
		<h4>Folder Setting</h4>
		<div class="field" ng-init="setting.list_sort=conf.local_store_dict('setting.sort@')">sort current folder:
			<select local-store="setting.sort@{{browser.url}}"
				ng-model="setting.list_sort[browser.url]" ng-change="browser.reload()">
				<option value="">with none</option>
				<option value="folder">by name</option>
				<option value="folder_desc">by name reverse</option>
				<option value="date">from latest</option>
				<option value="date_desc">from oldest</option>
			</select>
		</div>
		<h4>Play Setting</h4>
		<div class="field">play mode:
			<select local-store ng-model="setting.play_no_loop">
				<option value="">repeat</option>
				<option value="yes">norepeat</option>
			</select>
			<select local-store ng-model="setting.play_single_track">
				<option value="">list</option>
				<option value="yes">track</option>
			</select>
		</div>
		<div class="field">transcoding:
			<select local-store ng-model="setting.music_format_support">
				<option value="">auto</option>
				<option value="mp3">mp3</option>
				<option value="wav">wav</option>
				<option value="force,mp3">force mp3</option>
				<option value="force,wav">force wav</option>
			</select>
		</div>
		<h4>Global Setting</h4>
		<div class="field hidden">number of cached lists:
			<select local-store ng-model="setting.lists_in_cache">
				<option value="2">2</option>
				<option value="">4</option>
				<option value="8">8</option>
			</select>
		</div>
		<div class="field">display folders with:
			<select local-store ng-model="setting.folder_view_class">
				<option value="aa-none">no albumart</option>
				<option value="aa-list-view">small albumart</option>
				<option value="">big albumart</option>
			</select>
		</div>
		<div class="field">show images in:
			<select local-store ng-model="setting.img_open_self">
				<option value="">a new window</option>
				<option value="yes">current window</option>
			</select>
		</div>
		<div class="field">show text in:
			<select local-store ng-model="setting.txt_open_self">
				<option value="">a new window</option>
				<option value="yes">current window</option>
			</select>
		</div>
	</div>
</div>
<div class="player show-list-mode anim-transform">
	<div class="ctrl" ng-hide="player.show">
		<div class="albumart cursor-hand">
			<div ng-attr-style="background-image:{{audio.aaCssUrl}}"
				ng-click="image.open(audio.aaUrl, true)"></div>
		</div>
		<div class="buttonbar">
			<button ng-click="player.playnext(-1, true)">[ &laquo; ]</button>
			<button ng-click="player.playpause()" ng-dblclick="player.playnext(0)">
				<span ng-show="audio.state=='play'">[ | | ]</span>
				<span ng-hide="audio.state=='play'">[ &gt; ]</span>
			</button>
			<button ng-click="player.playnext(1, true)">[ &raquo; ]</button>
		</div>
		<div class="cursor-hand" ng-show="audio.info" ng-click="browser.open(player.url)">
			<span class="big">{{audio.info.artist}} - {{audio.info.name}}</span>
			<span ng-show="audio.state=='play'">[{{audio.current.mmss}}/{{audio.info.length}}]</span>
			<span ng-hide="audio.state=='play'">[{{audio.state}}]</span>
			<div class="info">
				<small>{{audio.info.album}} [{{audio.info.num}}]</small>
				<small ng-show="audio.lyric"
					ng-click="player.show=true;$event.stopPropagation()">[ lrc ]</small>
			</div>
		</div>
		<big ng-hide="audio.id">Ready to play</big>
	</div>
	<div class="lyric cursor-hand" ng-show="player.show" ng-click="player.show=false"
		pl-lyric="audio[pl-audio]" pl-lyric-bind="audio.lyric" pl-lyric-offset="0.8"
		pl-lyric-load="lyric.load(info, content)" pl-lyric-update="lyric.update(info, i, content[i])">
		<p class="gray" ng-hide="audio.lyric"><br />No lyric for this track</p>
		<img class="absolute abs-left anim-all anim-in-1s" ng-show="lyric.info.bkimg"
			ng-src="{{lyric.info.bkimg&&conf.res_url(lyric.info.bkimg, undefined, audio.info.path)}}" />
		<!-- Note: set a negative margin-top to avoid transform problem on android webview -->
		<div class="text absolute anim-all anim-in-1s full-width" style="margin-top:-90000px">
			<div class="line anim-all" lrc-id="{{$index}}" ng-class="$index==lyric.current.index&&'active'"
				ng-repeat="i in lyric.content" ng-if="i.d.substr">{{i.d}}</div>
		</div>
	</div>
	<audio pl-audio></audio>
	<input type="hidden" local-store ng-model="audio.id" />
	<input type="hidden" local-store ng-model="player.url" />
	<input type="hidden" local-store ng-model="player.playlist" />
	<!--canvas class="analyser" width="120" height="30" pl-analyser="audio[pl-audio]"></canvas-->
	<a class="processbar cursor-hand anim-all" ng-show="audio.id" ng-mousemove="player.getHoverPosition($event)"
		ng-mouseout="player.hoverMmss=''" ng-click="player.seek(player.hoverSec);player.play()">
		<span class="text">{{player.hoverMmss}}</span>
		<div class="bar" ng-style="{width:audio.current.sec/audio.length*100+'%'}"></div>
	</a>
</div>
<div class="img show-img-mode">
	<div class="mask absolute left-top anim-opacity"
		ng-style="{opacity:image.show?1:0}">
		<div class="fixed left-top full-width full-height" any-move="image.show=false"> </div>
		<div class="playinfo fixed left-bottom text-center full-width cursor-hand anim-opacity"
			ng-click="browser.open(player.url)">
			<span class="bold">{{audio.info.artist}} - {{audio.info.name}}</span>
			<small class="no-wrap">
				<span ng-show="audio.state=='play'">[{{audio.current.mmss}}/{{audio.info.length}}]</span>
				<span ng-hide="audio.state=='play'">[{{audio.state}}]</span>
			</small>
			<div class="info">
				<small>{{audio.info.album}} [{{audio.info.num}}]</small>
			</div>
		</div>
		<div class="fixed left-top bold gray text-center full-width"
			style="top:40%;opacity:0.7">
			<button class="float-left" style="padding:0.5em"
				ng-click="player.playnext(-1, true)">
				<img src="img/ic_action_previous.png" width="42px" />
			</button>
			<button class="gray" style="padding:0.5em"
				ng-click="player.playpause()" ng-dblclick="player.playnext(0)">
				<img src="img/ic_action_pause.png" width="64px" ng-show="audio.state=='play'" />
				<img src="img/ic_action_play.png" width="64px" ng-hide="audio.state=='play'" />
			</button>
			<button class="float-right" style="padding:0.5em"
				ng-click="player.playnext(1, true)">
				<img src="img/ic_action_next.png" width="42px" />
			</button>
		</div>
		<div class="fixed left-top full-width full-height" ng-hide="image.show"> </div>
	</div>
	<div class="buttonbar fixed right-top">
		<button ng-click="image.show=!image.show">...</button>
		<button ng-click="image.show=false;image.resize()">+</button>
		<button ng-click="browser.open(browser.url)">&laquo;</button>
	</div>
	<span class="loader fixed left-top text-center full-width">Loading...</span>
	<img class="block" img-src="image.url" img-load="image.load()"
		img-loading="image.loading()" img-loaded="image.loaded()" />
</div>
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/jq.util.js"></script>
<script src="js/angular.min.js"></script>
<script src="js/index.js"></script>
</body>
</html>
