<!DOCTYPE html>
<html ng-app="app">
<head>
<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>foo_mg_www</title>
<link type="text/css" href="theme.css" rel="stylesheet" />
<style>
.list .loading { -webkit-transition: opacity 1s ease; -moz-transition: opacity 2s ease;
	-ms-transition: opacity 1s ease; transition: opacity 1s ease; }

.head .return { position: absolute; padding-left: 0; left: 0; right: 120px; text-align: left; background-color: #fff; }
.show-tool .head .return { right: 240px; }
@media only screen and (min-width: 620px) {
	.head .return { right: 250px; } 
}

.list .info { font-size: 85%; color: #999; margin-top: 3px; }
.sep .bg { height: 90px; padding: 0.5em 0; padding-left: 0.5em; color: #fff; background: rgba(180, 180, 180, 0.4); }
.sep .link { float: right; margin: 0; padding: 0.5em 1em; color: white; font-weight: bold; }
.small-sep .sep .bg { height: auto; background: rgba(180, 180, 180, 0.8); }
.track .num { float: left; font-size: 125%; margin-top: -1px; margin-right: 5px; margin-bottom: 10px; color: #999; }
.track .duration { float: right; margin: -10px; padding: 10px; x-padding-bottom: 20px; }
.track .current { display: none; }
.track .check { float: right; margin-right: 7px; margin-top: 2px; width: 12px; height: 12px; border: 2px solid transparent; }

.folder .albumart { display: none; background-size: cover; background-position: center; margin-right: 10px; }
.aa-list-view .folder { min-height: 92px; }
.aa-list-view .folder .albumart { display: block; float: left; height: 96px; width: 96px; }
.aa-block-view .list>* { float: left; width: 100%; }
.aa-block-view .track { width: 92%; }
.aa-block-view .folder { width: 42%; max-width: 150px; margin-left: 16px; margin-right: 0;
	white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: none; }
.aa-block-view .folder .info { min-height: 1.5em; overflow: hidden; text-overflow: ellipsis; }
.aa-block-view .folder .albumart { display: block; width: 150px; height: 150px; }
@media only screen and (min-width: 1080px) {
	.list { right: auto; width: 540px; } 
	.tool, .player { left: 540px; } 
}

.track.play, .track.pause, .track.ended { border-left: 12px #fff solid; margin-left: 0px; font-weight: bold; }
.track.play { border-left: 12px #aaa solid; }
.track.pause { border-left: 12px #ccc solid; }
@media only screen and (max-width: 620px) {
	.track.play .current { display: inline; }
}
.on-edit .track .check { border-color: #888; }
.on-edit .track.dragging { opacity: 0.6; background-color: #eee; }
.on-edit .track.selected { background-color: #eee; }
.on-edit .track.selected .check { background-color: #aaa; }

.player { text-align: center; }
.player .albumart { float: left; cursor: pointer; background-image: url(../nocover.jpg); background-size: cover; background-position: center; }
.player .albumart div { width: 100%; height: 100%; background-size: cover; background-position: center; }
.player .buttonbar { max-width: 720px; margin: 5px auto; white-space: nowrap;; }
.player .buttonbar button { font-size: 120%; width: 30%; font-weight: bold; }
.player .info { margin-top: 5px; }
.player .processbar { width: 100%; background-color: #ddd; cursor: pointer; }
.player .processbar div { background-color: #666; width: 0; height: 8px; }
@media only screen and (max-width: 620px) {
	.player { font-size: 85%; white-space: nowrap; }
	.player .albumart { height: 80px; width: 80px; margin: 5px; }
	.player .buttonbar { padding-left: 80px; }
	.player .processbar { position: fixed; bottom: 0; }
	.player .processbar div { bottom: 0; height: 2px; }
}
@media only screen and (min-width: 621px) {
	.player { padding-left: 20px; }
	.player .buttonbar { margin: 20px; }
	.player .albumart { height: 130px; width: 130px; margin: 15px; }
	.player .buttonbar { padding-left: 140px; }
	.player .processbar { position: absolute; bottom: 0; }
}
@media only screen and (min-width: 1080px) {
	.tool { bottom: 200px; }
	.player { height: 200px; }
	.player .albumart { height: 170px; width: 170px; }
}

.head .tab { float: right; background-color: #eee;  }
.head .tab.ng-hide { display: block !important; background-color: transparent; }
.tool .close-tool { float: right; }
.tool .content { margin: 10px 0; }
.content h3 { border-left: 12px solid #888; padding-left: 8px; }
.content li { padding: 0.3em; margin: 0.2em; }
.content .field { margin: 10px; }
.content .search { margin: 5px 0; }
.content .search input[type=text] { width: 70%; }
.content .search input[type=submit] { width: 25%; max-width: 80px; }
@media only screen and (min-width: 621px) {
	.tool .close-tool { display: none; }
	.tool .content { margin: 20px; }
}

.content .playlist { margin: 0; padding: 0; }
.playlist form { padding: 0.3em; margin: 0.2em; }
.playlist input { width: 0; padding: 5px 0; margin-left: -10px; border: 1px solid #ddd; border-left: 28px solid #ddd; }
.playlist input:focus { width: 90%; }
.playlist input:focus+a { display: none; }
.playlist.active { font-weight: bold; }
.playlist.play input { border-color: #999; }

body.img-mode>.head, body.img-mode>.list, body.img-mode>.tool, body.img-mode>.player { display: none; }
body.list-mode>.img { display: none; }
</style>
</head>
<body ng-class="[showTool&&'show-tool', setting.folder_view_class||'aa-block-view', location.path+'-mode']"
	bw-main pl-ctrl ng-controller="main">
<div class="head">
	<button class="return" ng-click="browse(listParentPath)">{{listName}}</button>
	<button class="tab" ng-show="!showTool||showTool=='play'" ng-click="ctrl.toggleTool('play')">+</button>
	<button class="tab" ng-show="showTool=='nav'" ng-click="ctrl.toggleTool('nav')">#</button>
	<button class="tab" ng-show="showTool=='res'" ng-click="ctrl.toggleTool('res')">*</button>
	<button class="tab" ng-show="showTool=='conf'" ng-click="ctrl.toggleTool('conf')">...</button>
</div>
<ul class="list ng-hide" ng-class="[list.groupCount>3&&'small-sep',onEdit&&'on-edit']" bw-list ng-non-bindable ng-show="url==listUrl">
	<div class="sep" ng-attr-style="background-image:{{i.aaCssUrl}}" ng-repeat-start="i in ls" ng-if="i.newGroup">
		<a ng-show="setting.res_open_self" ng-href="#/img?url={{i.aaUrl|urlEncode}}"><small class="link">&raquo;</small></a>
		<a ng-hide="setting.res_open_self" target="blank" ng-href="{{i.aaUrl}}"><small class="link">&raquo;</small></a>
		<div class="bg" ng-click="i.path ? browse(i.path) : ctrl.toggleTool('res', 'res')">
			<big class="stress">{{i.album}}</big> ({{i.album_artist}})
		</div>
	</div>
	<li class="folder" bw-id="{{i.id}}" ng-attr-title="{{i.name}}" ng-if="i.typ=='folder'" ng-click="browse(i.path)">
		<div class="albumart" ng-attr-style="background-image:{{i.aaCssUrl}}"></div>
		<span class="float-right">&gt;</span>
		{{i.shortName}}
		<div class="info">{{i.bracS}} {{i.bracR}}</div>
	</li>
	<li class="track {{i.id==audio.id&&audio.state}}" pl-id="{{i.id}}" ng-repeat-end
		ng-if="i.typ=='track'" ng-click="list.onEdit ? select.toggle(i.id) : ctrl.playCurrent(i.id)">
		<span class="num">{{i.num}}</span>
		<span class="duration" ng-click="select.toggle(i.id);$event.stopPropagation()">
			<span class="current">{{audio.current.mmss}}/</span>{{i.length}}<br />
			<div class="check"></div>
		</span>
		{{i.name}}
		<div class="info">&lt;{{i.artist}}&gt;</div>
	</li>
	<div class="loading" show-delay="500" ng-click="load()" ng-hide="ls.length==total">loading ({{ls.length}}/{{total||'?'}})</div>
	<div class="empty" ng-hide="total!=0">No thing here</div>
</ul>
<div class="tool">
	<button class="close-tool" style="padding: 0.6em 1.2em;" ng-click="showTool=false">X</button>
	<div class="content" ng-show="!showTool||showTool=='play'">
		<h3>Playlists</h3>
		<button ng-hide="list.onEdit" ng-click="list.onEdit=true;ctrl.autoHideTool()">[ Select ]</button>
		<span class="edit-list" ng-show="list.onEdit">
			<button ng-click="select.finish();ctrl.autoHideTool()">[ Done ]</button>
			<button ng-click="select.toggle()">[ Toggle ]</button>
		</span>
		<span ng-hide="list.onEdit&&!select.length()">
			<button ng-click="ctrl.saveAsPlaylist()">[ Save ]</button>
			<button class="no-overflow">
				<select class="absolute no-opacity" style="max-width:80px;" ng-model="selectedUrl" ng-change="ctrl.addToPlaylist()">
					<option></option>
					<option ng-repeat="(u, n) in playlists" ng-value="u" ng-if="n">{{n}}</option>
				</select>[ AddTo ]
			</button>
		</span>
		<ul ng-init="playlists=('playlists@'|localStoreDict)">
			<!-- neither ng-class nor ng-show works with ng-repeat -->
			<li ng-repeat="(u, n) in playlists" class="playlist {{u==listUrl&&'active'}} {{u==playUrl&&'play'}}">
				<form ng-show="n.length||f" action="javascript:$('button:first').focus()">
					<input auto-select local-store="playlists@{{u}}" local-store-init="n"
						pl-url="{{u}}" ng-focus='f=1' ng-blur='f=0' ng-model="playlists[u]" />
					<a ng-href="#list?url={{u|urlEncode}}">{{n}}</a>
				</form>
			</li>
		</ul>
	</div>
	<div class="content" ng-show="showTool=='nav'">
		<h3>Search</h3>
		<form action="javascript:void(null)" ng-submit="ctrl.searchWord()">
			<div class="search">
				<input type="text" name="word" ng-model="search.word" /><input type="submit" value="Search" /><br />
			</div>
			<input type="checkbox" ng-model="search.fields.folder" />Folder
			<input type="checkbox" ng-model="search.fields.album" />Album
			<input type="checkbox" ng-model="search.fields.artist" />Artist
			<input type="checkbox" ng-model="search.fields.title" />Title
			<br />
			<input type="checkbox" ng-init="search.onpath=true" ng-model="search.onpath" />Search under current folder
		</form>
		<h3>Go To</h3>
		<button ng-click="browse()">[ root ]</button>
		<br />
		<button ng-click="reload()">[ reload list ]</button>
		<button onclick="location.reload()">[ reload page ]</button>
	</div>
	<div class="content" ng-show="showTool=='res'">
		<h3>Resource</h3>
		<div class="gray" ng-hide="list.resList.length">No Resource Here</div>
		<ul>
			<li ng-repeat="i in list.resList" ng-switch on="i.typ">
				<div ng-switch-when="img">
					<a ng-show="setting.res_open_self" ng-href="#/img?url={{i.url|urlEncode}}">{{i.name}}</a>
					<a ng-hide="setting.res_open_self" target="blank" ng-href="{{i.url}}">{{i.name}}</a>
				</div>
				<a ng-switch-default target="blank" ng-href="{{i.url}}">{{i.name}}</a>
			</li>
		</ul>
	</div>
	<div class="content" ng-show="showTool=='conf'">
		<h3>Folder Settings</h3>
		<div class="field">sort current folder:
			<select local-store local-store-bind="'setting.sort@'+listUrl" ng-model="setting.list_sort_field" ng-change="reload()">
				<option value="">with none</option>
				<option value="folder">by name</option>
				<option value="folder_desc">by name reverse</option>
				<option value="date">from latest</option>
				<option value="date_desc">from oldest</option>
			</select>
		</div>
		<h3>Play Settings</h3>
		<div class="field">play mode:
			<select local-store ng-model="setting.play_no_loop">
				<option value="">repeat</option>
				<option value="yes">norepeat</option>
			</select>
			<select local-store ng-model="setting.play_single_track">
				<option value="">list</option>
				<option value="yes">track</option>
			</select>
		</div>
		<div class="field">transcoding:
			<select local-store ng-model="setting.music_format_support">
				<option value="">auto</option>
				<option value="mp3">mp3</option>
				<option value="wav">wav</option>
				<option value="force,mp3">force mp3</option>
				<option value="force,wav">force wav</option>
			</select>
		</div>
		<h3>Global Settings</h3>
		<div class="field">display folders with:
			<select local-store ng-model="setting.folder_view_class">
				<option value="aa-none">no albumart</option>
				<option value="aa-list-view">small albumart</option>
				<option value="">big albumart</option>
			</select>
		</div>
		<div class="field">open resource in:
			<select local-store ng-model="setting.res_open_self">
				<option value="">a new window</option>
				<option value="yes">current window</option>
			</select>
		</div>
	</div>
</div>
<div class="player">
	<audio pl-audio></audio>
	<input type="hidden" local-store ng-model="audio.id" />
	<input type="hidden" local-store ng-model="playUrl" />
	<input type="hidden" local-store ng-model="playlist" />
	<div class="albumart" ng-click="listUrl=playUrl;ctrl.autoHideTool()">
		<div ng-attr-style="background-image:{{audio.aaCssUrl}}"></div>
	</div>
	<div class="buttonbar">
		<button ng-click="playnext(-1, true)">[ &laquo; ]</button>
		<button ng-click="play()" ng-hide="audio.state=='play'">[ &gt; ]</button>
		<button ng-click="pause()" ng-show="audio.state=='play'">[ || ]</button>
		<button ng-click="playnext(1, true)">[ &raquo; ]</button>
	</div>
	<div ng-show="audio.id">
		<big>{{audio.info.artist}} - {{audio.info.name}}</big>
		<span ng-show="audio.state=='play'">[{{audio.current.mmss}}/{{audio.info.length}}]</span>
		<span ng-hide="audio.state=='play'">[{{audio.state}}]</span>
		<div class="info">
			<small>{{audio.info.album}} [{{audio.info.num}}]</small>
		</div>
	</div>
	<big ng-hide="audio.id">Ready to play</big>
	<div ng-show="audio.id" class="processbar">
		<div ng-style="{width:audio.current.sec/audio.length*100+'%'}"></div>
	</div>
</div>
<div class="img">
	<img ng-src="{{imgUrl}}" />
</div>
<script src="jquery-1.8.0.min.js"></script>
<script src="jq.util.js"></script>
<script src="angular.min.js"></script>
<script src="index.js"></script>
</body>
</html>
